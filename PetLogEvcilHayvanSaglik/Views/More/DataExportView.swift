import SwiftUI\r\n\r\nstruct DataExportFullView: View {\r\n    let store: PetStore\r\n    let premiumManager: PremiumManager\r\n    @State private var exportType: ExportType = .summary\r\n    @State private var showPaywall = false\r\n\r\n    private var pet: Pet? { store.selectedPet }\r\n\r\n    var body: some View {\r\n        List {\r\n            Section {\r\n                Text("Evcil hayvanınızın sağlık ve finans verilerini dışa aktarın.")\r\n                    .font(.subheadline)\r\n                    .foregroundStyle(.secondary)\r\n            }\r\n\r\n            if let pet {\r\n                Section("\\(pet.name) Özeti") {\r\n                    StatRow(label: "Kilo Kayıtları", value: "\\(pet.weightLogs.count)", icon: "scalemass.fill", iconColor: .green)\r\n                    StatRow(label: "Aşılar", value: "\\(pet.vaccineRecords.count)", icon: "syringe.fill", iconColor: .purple)\r\n                    StatRow(label: "İlaçlar", value: "\\(pet.medications.count)", icon: "pills.fill", iconColor: .blue)\r\n                    StatRow(label: "Veteriner Ziyaretleri", value: "\\(pet.vetVisits.count)", icon: "cross.case.fill", iconColor: .red)\r\n                    StatRow(label: "Harcamalar", value: "\\(pet.expenses.count)", icon: "turkishlirasign.circle.fill", iconColor: .orange)\r\n                }\r\n\r\n                Section("Dışa Aktarma Formatı") {\r\n                    Picker("Format", selection: $exportType) {\r\n                        ForEach(ExportType.allCases, id: \\.self) { type in\r\n                            Text(type.title).tag(type)\r\n                        }\r\n                    }\r\n                    .pickerStyle(.segmented)\r\n                }\r\n\r\n                Section {\r\n                    switch exportType {\r\n                    case .summary:\r\n                        ShareLink(item: generateSummaryText(pet)) {\r\n                            Label("Özet Paylaş", systemImage: "square.and.arrow.up")\r\n                        }\r\n                    case .json:\r\n                        if premiumManager.hasFullAccess {\r\n                            ShareLink(item: DataExportService.shared.exportJSON(for: pet, store: store)) {\r\n                                Label("JSON Dışa Aktar", systemImage: "doc.badge.arrow.up")\r\n                            }\r\n                        } else {\r\n                            Button {\r\n                                showPaywall = true\r\n                            } label: {\r\n                                HStack {\r\n                                    Label("JSON Dışa Aktar", systemImage: "doc.badge.arrow.up")\r\n                                    Spacer()\r\n                                    Image(systemName: "lock.fill")\r\n                                        .foregroundStyle(.orange)\r\n                                }\r\n                            }\r\n                        }\r\n                    case .csv:\r\n                        if premiumManager.hasFullAccess {\r\n                            ShareLink(item: DataExportService.shared.exportCSV(for: pet)) {\r\n                                Label("CSV Dışa Aktar (Harcamalar)", systemImage: "tablecells")\r\n                            }\r\n                        } else {\r\n                            Button {\r\n                                showPaywall = true\r\n                            } label: {\r\n                                HStack {\r\n                                    Label("CSV Dışa Aktar (Harcamalar)", systemImage: "tablecells")\r\n                                    Spacer()\r\n                                    Image(systemName: "lock.fill")\r\n                                        .foregroundStyle(.orange)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        .navigationTitle("Veri Dışa Aktar")\r\n        .navigationBarTitleDisplayMode(.inline)\r\n        .sheet(isPresented: $showPaywall) {\r\n            PetLogPaywallView(premiumManager: premiumManager)\r\n        }\r\n    }\r\n\r\n    private func generateSummaryText(_ pet: Pet) -> String {\r\n        var text = "PetLog Sağlık & Finans Raporu\\n"\r\n        text += "Hayvan: \\(pet.name) (\\(pet.species.rawValue))\\n"\r\n        text += "Yaş: \\(pet.age)\\n\\n"\r\n        if let weight = pet.latestWeight {\r\n            text += "Güncel Kilo: \\(String(format: "%.1f", weight)) kg\\n"\r\n        }\r\n        text += "Toplam Harcama (Yıl): \\(store.annualSpending(for: pet).formatted(.currency(code: "TRY")))\\n"\r\n        text += "Aktif İlaçlar: \\(pet.activeMedications.count)\\n"\r\n        text += "Aşı Kayıtları: \\(pet.vaccineRecords.count)\\n"\r\n        text += "Veteriner Ziyaretleri: \\(pet.vetVisits.count)\\n"\r\n        return text\r\n    }\r\n}\r\n\r\nnonisolated enum ExportType: String, CaseIterable, Sendable {\r\n    case summary\r\n    case json\r\n    case csv\r\n\r\n    var title: String {\r\n        switch self {\r\n        case .summary: return "Özet"\r\n        case .json: return "JSON"\r\n        case .csv: return "CSV"\r\n        }\r\n    }\r\n}\r\n
